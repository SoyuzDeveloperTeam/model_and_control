//-------------------------------------------------------------------------------
// ModKA.h
// А. Николенко 26.11.2018
//
// Расчёт характеристик взаимной видимости КА-НИП 
//------------------------------------------------------------------------------- 
#ifndef ZNIP_H
#define ZNIP_H

//-------------------------------------------------------------------------------
// Описание координат и характеристик НИП
typedef struct ZNIP {
int		Num ;		// Номер
int		Type ;		// Тип
char	Name[64] ;	// Название 
char	Call[64] ;	// Позывной
double  B ;			// Широта, град
double  L ;			// Долгота, град
double  H ;			// Превышение над элипсоидом, км
double  MaxGam ;	// Максимально-возможный угол места, град	 
double  MinGam ;	// Минимально-допустимый угол места, град	 
double  xyz[3] ;	// Координаты в ГСК, дткм и дткм/ссс
double  gsc2tpc[9] ;// Матрица перехода от ГСК к топоцентрической СК
} ZNIP ;			// 

// Массив с координатами и характеристиками НИП
FLYCORE_API extern ZNIP ALLNIPS[];

//-------------------------------------------------------------------------------
// Описание характеристик зоны радиовидимости КА с НИП
typedef struct ZZRV {
char    isFound ;	// (1|2|4) (1-найден вх. 2-найден вых. 4-найден параметр)
int     KA ;		// Номер КА
int		Nip ;		// Номер НИП
long    Vit ;		// Виток 
double  A1 ;		// Азимут входа, град
double  Ap ;		// Азимут параметра, град
double  A2 ;		// Азимут выхода, град
double  G1 ;		// Угол места входа, град
double  Gmax ;		// Угол места на параметре, град
double  G2 ;		// Угол места выхода, град
double  t1 ;		// Время входа, IAT в ссс
double  tp ;		// Время прохождения параметра, IAT в ссс
double  t2 ;		// Время выхода, IAT в ссс
double  X[7] ;		// Параметры движения на момент входа в ЗРВ, 
} ZZRV ;			// для расчёта ЦУ

FLYCORE_API bool operator < (ZZRV& Z1, ZZRV& Z2);

//-------------------------------------------------------------------------------
// Расчёт параметров радиовидимости КА с НИП
// Дано:  
//		NIP		- НИП для которого рассчитываются параметры	
//		GSK		- координаты КА в ГСК  
// Результаты:
//		Params[0] - угол места, град
//		Params[1] - скорость изменения угла места, град/сек
//		Params[2] - дальность до КА, км
//		Params[3] - скорость измененич дальности км/сек
//		Params[4] - азимут, град
//		Params[5] - e1 - первый угол КИС "Куб-контур", град
//		Params[6] - e2 - второй угол КИС "Куб-контур", град
//
FLYCORE_API int  CalcZRVParams(ZNIP *NIP, double* GSK, double* Params);
FLYCORE_API void PARAMETR_KA_NIP(double *Gsk, ZNIP *NIP, double *Params);
//------------------------------------------------------------------------------- 
#endif // #ifndef ZNIP_H